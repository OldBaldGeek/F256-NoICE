# F256-NoICE
## Tools and techniques to use NoICE on the Foenix F256 retro system

NoICE Debugger (https://www.noicedebugger.com) is a remote debugger
analogous to using gdb with a remote stub. 
NoICE supports a variety of 8-bit and 16-bit targets, including the 65C02
and 6809 processors supported by the F256.

The UI of NoICE runs under Windows. For 65(C)02, 6809, and similar targets,
NoICE uses a small target monitor, usually communicating via a serial line.
Full details of the protocol may be found on the NoICE website.

This project is intended to allow NoICE to be used to debug programs running
on the Foenix F256 system.

NoICE itself is not Open Source or Free. However, files posted in this
repository are in the public domain.

## Target Monitor

NoICE ships (or downloads) with source code for standard monitors. This
repository contains monitors modified to support various modes of operation
on F256 hardware.

### Mon6502_F256_Merlin.asm

This is the standard NoICE monitor for the 6502 modified in several ways:
- Assembles with the Merlin32 assembler
- Configured to be loaded into and run from the top 2K of logical memory
  (addresses 0xFF80 to 0xFFFF), taking control of the interrupt vectors.
- May be edited to load into any physical block of RAM
- The build process generates a .pgz file that can be loaded into the F256
  by standard F256 tools

## Support Utilities

NoICE is most conveniently used as a source-level debugger. However, doing that
requires appropriate debug information about the code being debugged. NoICE
supports elf/dwarf debug files, but these are not generated by F256 tools
that I have seen. Thus, utilities are provided to extract at least some debug
information from the available tools.

### merlin_noi.py

This Python program processes the file.pgz (or file.pgx) and fle.pgz.output.txt
files generated by Merlin32 when the -V option is specified.
Two output files are generated:
- file.pgz.noi contains symbol and label definitions, and source-file and
  line information for source-level debugging.
- file.pgz.s19 contains Motorola S2-records containing program data. This file
  is intended for loading by NoICE, rather than being general-purpose.

### fnxmgr.py

This is a modification of the released fnxmgr to add several commands useful
to better control resets of the target processor when loading multiple files.
the new commands are
- --assert_reset which asserts reset by sending ENTER_DEBUG, and suspends 
  automatic ENTER/EXIT_DEBUG
- --release_reset which releases reset by sending EXIT_DEBUG) and resumes
  automatic ENTER/EXIT_DEBUG
- --whack which allows explicit reset, release, start, and stop without affecting
  automatic ENTER/EXIT_DEBUG

For an example of use, see noi_runner.bat

### noi_runner.bat
This command file is intended to be used as an interface between NoICE
and fnxmgr to load the NoICE monitor and user programs.

To configure NoICE:
1. Run NoICE (possibly getting timeout errors if no monitor is running)
2. Select "Options," "Extensions..."
3. Under "When NoICE starts..." enter the path to this file.
   Select "Wait for program to complete before continuing."
4. Under "At LOAD command..." enter the path to this file, and add "%1"
   to pass the name of the file to be loaded as a parameter.
5. Select "OK"

When NoICE runs on the PC, it will invoke this file to load the monitor.
When you tell NoICE to LOAD a file, the name of the file will be passed
to this file. The file will be loaded, and the monitor reloaded since fnxmgr
may overwrite the reset vector, and it resets the target.

### noice02.noi
This is a NoICE command file. If you PLAY this file in NoICE, it will define
memory locations 0 and 1 as pseudo-registers, to show mmu_crtl and io_crtl in
the Register window.
It also defines pseudo-registers for the LUT values, but they are only valid
when the EDIT bit of mmu_crtl is set, so you may prefer to delete them.

If you place this file in the same directory as NoICE02.exe, it will be played
automatically whenever you run NoICE.
